name: test123
on:
  push:
    branches:
      - master

jobs:
  test123:
    runs-on: ubuntu-22.04
    permissions:
      packages: write
    steps:
      - name: "run shell"
        shell: bash
        env:
          OCI_USERNAME: AlexanderRichert-NOAA
          OCI_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git clone --depth 1 https://github.com/spack/spack
          cd spack
          . share/spack/setup-env.sh
          spack mirror add spack-build-cache oci://ghcr.io/$OCI_USERNAME
          spack mirror set --push --oci-username-variable OCI_USERNAME --oci-password-variable OCI_TOKEN spack-build-cache
          spack install gmake
          spack buildcache push --base-image ubuntu:22.04 --update-index spack-build-cache gmake
